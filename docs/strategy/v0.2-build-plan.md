# LLM SLO eBPF Toolkit v0.2 Build Plan

Status: Approved working plan  
Plan date: 2026-02-18

## Locked Decisions
- Primary language: Go.
- Local cluster: kind (3-node default profile).
- Observability stack: Grafana + Prometheus + Tempo + OTel Collector.
- eBPF path: libbpf CO-RE primary; BCC fallback for non-BTF hosts.
- Overhead gates: development <=5% CPU overhead; GA <=3%.
- Deterministic LLM backend for local incident and benchmark runs.
- Privileged eBPF integration runs on self-hosted Linux CI only.

## Current Anchors to Preserve
- `docs/contracts/v1/slo-event.schema.json`
- `docs/contracts/v1/incident-attribution.schema.json`

External outputs keep v1 compatibility. New probe-level schema is introduced under `v1alpha1`.

## Corrected Design Decisions (Release-Critical)

### 1) Correlation threshold and enrichment consistency
- Join confidence tiers:
  - exact `trace_id` in window: `1.0`
  - `pod+pid` in <=100ms: `0.9`
  - `pod+conn_tuple` in <=250ms: `0.8`
  - `service+node` in <=500ms: `0.65` (debug only)
- Span enrichment rule remains `confidence >= 0.7`.
- Outcome: `0.65` tier contributes unmatched/diagnostic views only, never hard span enrichment.

### 2) Required signal set vs fallback mode
- CO-RE reference environments must satisfy full 6-signal coverage.
- BCC fallback is explicitly a degraded mode (DNS + retransmits only).
- GA blocking gate applies to CO-RE reference kernels; fallback does not block GA but must surface capability flags in reports.

### 3) Config schema normalization
- `config/toolkit.schema.json` uses nested objects, not dotted-key pseudo-fields.
- Required structure:
  - `signal_set`
  - `sampling`
  - `correlation.window_ms`
  - `otlp.endpoint`
  - `safety.max_overhead_pct`

### 4) Benchmark statistical power
- Minimum repetitions per profile: 10 (not 5) for distribution claims.
- If fewer than 10 runs, results are marked exploratory and cannot gate release.
- Report requires CI95 for latency and attribution metrics plus run count and class balance.

### 5) CI runtime partitioning
- Nightly: short smoke subset (DNS, retransmit, CPU) with reduced phase durations.
- Weekly: full scenario matrix and release-tag comparisons.
- Goal: preserve signal quality without making nightly pipelines impractical.

### 6) Self-hosted runner security baseline
- Ephemeral runner instances per privileged job.
- Isolated node pool with no shared production credentials.
- Artifact scrubbing before publish/upload.
- Minimal scoped tokens and short-lived credentials only.

### 7) Initial release baseline rule
- If no prior stable tag exists, use first GA anchor tag as baseline reference.
- Comparison matrix rule:
  - preferred: `main` vs `v0.2-rc` vs previous stable
  - fallback: `main` vs `v0.2-rc` vs first GA anchor

## Milestone Windows and Hard Gates

| Milestone | Dates (2026) | Must-Ship | Hard Gate |
|---|---|---|---|
| M0 Bootstrap | Feb 17-Feb 23 | Buildable repo, kind bootstrap, CI build/lint/unit, DS heartbeat | `make build` and `make test` on clean env |
| M1 Demo + OTel | Feb 24-Mar 2 | Streaming demo, baseline TTFT/tokens/sec, first correlated signal | MVP checkpoint by Mar 2 |
| M2 Signals v1 | Mar 3-Mar 16 | Six CO-RE signals, schema, enricher, safety toggles | overhead <=5% (dev gate) |
| M3 Correlation | Mar 17-Mar 23 | Collector correlator, retrieval decomposition, retry storm detector | precision >=0.90 and recall >=0.85 |
| M4 Incident Lab | Mar 24-Mar 30 | 6 deterministic scenarios, dashboards, alerts | v0.2 RC by Mar 30 |
| M5 Bench + Release | Mar 31-Apr 13 | Tag replay, regression gates, SBOM/provenance, GA docs | v0.2 GA by Apr 13 and overhead <=3% |

## Deterministic Harness Defaults
- Seed: `42`
- Load profile: `rag_mixed_20rps`
- Full phase durations: baseline `10m`, fault `10m`, recovery `5m`
- Nightly smoke profile may use reduced durations; weekly full run uses canonical durations.

## Acceptance Summary for v0.2 GA
- CO-RE reference validation passes six-signal requirement.
- Correlation precision >=0.90 and recall >=0.85 on labeled set.
- Overhead gate <=3% CPU on baseline profile.
- Incident reproducibility variance <=10% across three reruns.
- Signed release with SBOM, provenance, and benchmark appendix.
