apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "llm-slo-agent.fullname" . }}-config
  namespace: {{ include "llm-slo-agent.namespace" . }}
  labels:
    {{- include "llm-slo-agent.labels" . | nindent 4 }}
data:
  toolkit.yaml: |
    apiVersion: toolkit.llm-slo.dev/v1alpha1
    kind: ToolkitConfig
    signal_set:
      {{- range .Values.toolkit.signalSet }}
      - {{ . }}
      {{- end }}
    sampling:
      events_per_second_limit: {{ .Values.toolkit.sampling.eventsPerSecondLimit }}
      burst_limit: {{ .Values.toolkit.sampling.burstLimit }}
    correlation:
      window_ms: {{ .Values.toolkit.correlation.windowMS }}
    otlp:
      endpoint: {{ .Values.otlp.endpoint }}
    safety:
      max_overhead_pct: {{ .Values.toolkit.safety.maxOverheadPct }}
    webhook:
      enabled: {{ .Values.webhook.enabled }}
      url: {{ .Values.webhook.url | quote }}
      secret: {{ .Values.webhook.secret | quote }}
      format: {{ .Values.webhook.format }}
      timeout_ms: {{ .Values.webhook.timeoutMS }}
    cdgate:
      enabled: {{ .Values.cdgate.enabled }}
      prometheus_url: {{ .Values.cdgate.prometheusURL }}
      ttft_p95_ms: {{ .Values.cdgate.ttftP95MS }}
      error_rate: {{ .Values.cdgate.errorRate }}
      burn_rate: {{ .Values.cdgate.burnRate }}
      fail_open: {{ .Values.cdgate.failOpen }}
  scenario: {{ .Values.agent.scenario | quote }}
  output_mode: {{ .Values.agent.outputMode | quote }}
  event_kind: {{ .Values.agent.eventKind | quote }}
  capability_mode: {{ .Values.agent.capabilityMode | quote }}
  disable_signals: {{ .Values.agent.disableSignals | quote }}
  disable_overhead_guard: {{ .Values.agent.disableOverheadGuard | quote }}
  enable_hello_tracer: {{ .Values.agent.enableHelloTracer | quote }}
  hello_target_comm: {{ .Values.agent.helloTargetComm | quote }}
  enable_real_probe_metrics: {{ .Values.agent.enableRealProbeMetrics | quote }}
